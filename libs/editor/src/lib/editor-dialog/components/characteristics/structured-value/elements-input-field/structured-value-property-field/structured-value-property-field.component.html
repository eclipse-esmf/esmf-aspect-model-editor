<div fxLayout="row" fxLayoutGap="15px" fxLayoutAlign="space-between center">
  <mat-form-field>
    <mat-label for="left">Property<ng-container *ngIf="isAsteriskVisible()"> *</ng-container></mat-label>
    <input #property [matAutocomplete]="auto" [formControl]="control" matInput name="property-element" data-cy="property-element" />
    <button
      *ngIf="control?.disabled && !overwrittenProperty?.property?.isExternalReference()"
      (click)="unlock()"
      class="close-button"
      data-cy="clear-property-button"
      matSuffix
      mat-icon-button
      tabindex="-1"
    >
      <em class="Bosch-Ic Bosch-Ic-abort"></em>
    </button>

    <mat-autocomplete #auto="matAutocomplete" class="property-element">
      <mat-optgroup *ngIf="filteredProperties$ | async as filteredProperties" label="Property">
        <mat-option
          *ngIf="!filteredProperties.length"
          [disabled]="!isLowerCase(property.value)"
          [value]="!isLowerCase(property.value) ? '' : property.value"
          (click)="createNewProperty(property.value)"
        >
          <span *ngIf="isLowerCase(property.value)" data-cy="new-property">
            + Create new property: <strong>{{ property.value }}</strong>
          </span>
          <span *ngIf="!isLowerCase(property.value)">Please provide the name for the new Property in lower case.</span>
        </mat-option>
        <mat-option
          *ngFor="let filteredProperty of filteredProperties"
          [value]="filteredProperty.name"
          (onSelectionChange)="onSelectionChange(filteredProperty)"
        >
          {{ filteredProperty.name }}<br /><span class="option-description">{{ filteredProperty.description }}</span>
        </mat-option>
      </mat-optgroup>
    </mat-autocomplete>
    <mat-error *ngIf="control?.errors?.required">Please choose or create a Property</mat-error>
    <mat-error *ngIf="control?.errors?.disabled">No property defined</mat-error>
  </mat-form-field>
</div>
