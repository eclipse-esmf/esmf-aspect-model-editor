<!--
  ~ Copyright (c) 2026 Robert Bosch Manufacturing Solutions GmbH
  ~
  ~ See the AUTHORS file(s) distributed with this work for
  ~ additional information regarding authorship.
  ~
  ~ This Source Code Form is subject to the terms of the Mozilla Public
  ~ License, v. 2.0. If a copy of the MPL was not distributed with this
  ~ file, You can obtain one at https://mozilla.org/MPL/2.0/.
  ~
  ~ SPDX-License-Identifier: MPL-2.0
  -->

<h2 mat-dialog-title>{{ 'SAMM_MIGRATION.WORKSPACE_MIGRATION_DIALOG.TITLE' | translate }} {{ config.currentSammVersion }}</h2>

<mat-dialog-content class="migration">
  <mat-stepper #stepper linear>
    <mat-step [editable]="false">
      <p>
        {{ 'SAMM_MIGRATION.WORKSPACE_MIGRATION_DIALOG.FILE_VERSION_WARNING' | translate }}
        <strong>{{ config.currentSammVersion }}</strong> {{ 'SAMM_MIGRATION.WORKSPACE_MIGRATION_DIALOG.MIGRATION_NEEDED' | translate }}
        <br />
        {{ 'SAMM_MIGRATION.WORKSPACE_MIGRATION_DIALOG.MIGRATE_INSTRUCTION' | translate }}
      </p>
      <mat-checkbox [checked]="increaseNamespaceVersion" (change)="changeVersionCheck($event)">
        {{ 'SAMM_MIGRATION.WORKSPACE_MIGRATION_DIALOG.VERSION_AUTO_UPGRADE' | translate }}
      </mat-checkbox>
      <p class="version-description">
        {{ 'SAMM_MIGRATION.WORKSPACE_MIGRATION_DIALOG.UPGRADE_EFFECT' | translate }}
      </p>
    </mat-step>
    <mat-step [editable]="false">
      @if (migrationStatus()?.success) {
        <div class="content">
          <mat-icon class="content__icon">done</mat-icon>
          <p>{{ 'SAMM_MIGRATION.MIGRATION_DIALOG.SUCCESS_CONTENT' | translate }}</p>
        </div>
        @if (migrationStatus()?.errors?.length) {
          <mat-divider></mat-divider>
          <div class="content__banner">
            <mat-icon>warning</mat-icon>
            {{ 'SAMM_MIGRATION.MIGRATION_DIALOG.WARNING_CONTENT' | translate }}
          </div>
          <label>Migration Message:</label>
          <ul>
            @for (error of migrationStatus().errors; track error) {
              <li>{{ error }}</li>
            }
          </ul>
        }
      } @else {
        <mat-icon class="icon">error</mat-icon>
        <p>{{ 'SAMM_MIGRATION.MIGRATION_DIALOG.ERROR_CONTENT' | translate }}</p>
        @if (migrationStatus()?.errors?.length) {
          <mat-divider></mat-divider>
          <div class="content__banner">
            <mat-icon>warning</mat-icon>
            {{ 'SAMM_MIGRATION.MIGRATION_DIALOG.WARNING_CONTENT' | translate }}
          </div>
          <ul>
            @for (error of migrationStatus().errors; track error) {
              <li>{{ error }}</li>
            }
          </ul>
        }
      }
    </mat-step>
  </mat-stepper>
</mat-dialog-content>

<mat-dialog-actions align="end">
  @if (currentStep() === 0) {
    @if (!loading()) {
      <button (click)="closeDialog()" mat-flat-button>
        {{ 'SAMM_MIGRATION.WORKSPACE_MIGRATION_DIALOG.CANCEL' | translate }}
      </button>
    }
    <button [disabled]="loading()" (click)="migrate()" mat-flat-button color="primary">
      @if (!loading()) {
        <span>{{ 'SAMM_MIGRATION.WORKSPACE_MIGRATION_DIALOG.MIGRATE' | translate }}</span>
      }
      @if (loading()) {
        <mat-spinner class="spinner" diameter="20"></mat-spinner>
      }
    </button>
  }
  @if (currentStep() === 1) {
    <button (click)="closeDialog()" mat-flat-button>
      {{ 'SAMM_MIGRATION.MIGRATION_DIALOG.CLOSE' | translate }}
    </button>
  }
</mat-dialog-actions>
